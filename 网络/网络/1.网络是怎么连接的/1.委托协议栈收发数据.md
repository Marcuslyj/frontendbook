### 收发数据的操作分为若干个阶段

（1）创建套接字（创建套接字阶段） 

（2）将管道连接到服务器端的套接字上（连接阶段） 

（3）收发数据（通信阶段） 

（4）断开管道并删除套接字（断开阶段）



### 创建套接字

调用Socket.socket，套接字创建完成，返回**描述符**。描述符是用来识别不同的套接字的（可理解为给套接字分配的编号）。

客户端在创建套接字时，协议栈会为这个套接字随便分配一个端口号。

#### 套接字是什么





### 连接阶段

调用Socket.connect，要委托协议栈将客户端创建的套接字与服务器那边的套接字连接起来。当连接成功后，协议栈会将对方的 IP 地址和端口号等信息保存在套接字中，这样我们就可以开始收发数据了。



Socket.connect需要指定3个参数：描述符、服务器IP地址、端口号。

参数1：描述符。协议栈根 据这个描述符来判断到底使用哪一个套接字去和服务器端的套接字进行连 接，并执行连接的操作。

参数2：服务器 IP 地址。

参数3：端口号。网络连接另一方的识别套接字。

IP 地址和端口号：客户端和服务器之间用来识别对方套接字的机制。

> 为什么使用描述符+端口号？

- 只用描述符？

因为描述符是和委托创建套接字的应用程序进行交互时使用的，并不是用来告诉网络连接的另一方的，因此 另一方并不知道这个描述符。同样地，客户端也无法知道服务器上的描述符。

描述符是和委托创建套接字的应用程序进行交互时使用的，并不是用来告诉网络连接的另一方的，因此另一方并不知道这个描述符。如果说描述符是用来在一台计算机内部识别套接字的机制，那么端口号就是用来让通信的另一方能够识别出套接字的机制。

- 只用端口号？





### 通信阶段

只要将数据送入套接字，数据就会被发送到对方的套接字中。

发送消息：调用Socket.write。指定描述符和发送数据。

接收消息：调用Socket.read。指定存放响应消息的内存地址（缓冲区，位于应用程序内部的内存空间）。





### 断开阶段

调用Socket.close。最终，连接在套接字之间的管道会被断开，套接字本身也会被删除。

> 谁调用？

Web 使用的 HTTP 协议规定，当 Web 服务器发送完 响应消息之后，应该主动执行断开操作，因此 Web 服务器会首先调用 close 来断开连接。断开操作传达到客户端之后，客户端的套接字也会进入 断开阶段。接下来，当浏览器调用 read 执行接收数据操作时，read 会告知 浏览器收发数据操作已结束，连接已经断开。浏览器得知后，也会调用 close 进入断开阶段。

大量资源请求，对于同一台服务器来 说，重复连接和断开显然是效率很低的，因此后来人们又设计出了能够在 一次连接中收发多个请求和响应的方法。在 HTTP 版本 1.1 中就可以使用这种方法，在这种情况下，当所有数据都请求完成后，浏览器会主动触发断开连接的操作。
### 交换机根据地址表进行转发

交换机根据 MAC 地址表查找 MAC 地址，然后将信号发送到相 应的端口。

大家可以认为交换机的每个网线接口后面都是一块网卡。网线接口 和后面的电路部分加在一起称为一个端口，也就是说交换机的一个端口就相当于计算机上的一块网卡。

但交换机的工作方式和网卡有一点不同。网 卡本身具有 MAC 地址，并通过核对收到的包的接收方 MAC 地址判断是不是发给自己的，如果不是发给自己的则丢弃；相对地，交换机的端口不 核对接收方 MAC 地址，而是直接接收所有的包并存放到缓冲区中。因此， 和网卡不同，交换机的端口不具有 MAC 地址。

将包存入缓冲区后，接下来需要查询一下这个包的接收方 MAC 地址 是否已经在 MAC 地址表中有记录了。MAC 地址表主要包含两个信息，一 个是设备的 MAC 地址，另一个是该设备连接在交换机的哪个端口上。MAC 地址和端口是一一对应的，通过这张表就能 够判断出收到的包应该转发到哪个端口。



### MAC 地址表的维护

第一种是收到包时，将发送方 MAC 地址以及其输入端口的号码写入 MAC 地址表中。由于收到包的那个端口就连接着发送这个包的设备，所以 只要将这个包的发送方 MAC 地址写入地址表，以后当收到发往这个地址 的包时，交换机就可以将它转发到正确的端口了。交换机每次收到包时都 会执行这个操作，因此只要某个设备发送过网络包，它的 MAC 地址就会 被记录到地址表中。

另一种是删除地址表中某条记录的操作，这是为了防止设备移动时产 生问题。比如，我们在开会时会把笔记本电脑从办公桌拿到会议室，这时 设备就发生了移动。从交换机的角度来看，就是本来连接在某个端口上的 笔记本电脑消失了。这时如果交换机收到了发往这台已经消失的笔记本电 脑的包，那么它依然会将包转发到原来的端口，通信就会出错，因此必须 想办法删除那些过时的记录。然而，交换机没办法知道这台笔记本电脑已 经从原来的端口移走了。因此地址表中的记录不能永久有效，而是要在一 段时间不使用后就自动删除。



> MAC 地址表没记录接收方时候，怎么知道到接收方是哪个端口？怎么走？

一种特殊情况，就是地址表中找不到指定的 MAC 地址。这 可能是因为具有该地址的设备还没有向交换机发送过包，或者这个设备一 段时间没有工作导致地址被从地址表中删除了。这种情况下，交换机无法 判断应该把包转发到哪个端口，只能将包转发到除了源端口之外的所有端 口上，无论该设备连接在哪个端口上都能收到这个包。这样做不会产生什 么问题，因为以太网的设计本来就是将包发送到整个网络的，然后只有相 应的接收者才接收包，而其他设备则会忽略这个包。